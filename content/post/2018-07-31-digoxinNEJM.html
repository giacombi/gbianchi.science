---
title: "The effect of digoxin on mortality and morbidity in patients with heart failure: a case of reproducible research"
author: Giacomo Bianchi
date: '2017-12-30'
type: "post"
output:
    html_document:
        theme: "cosmo"
        highlight: "default"
        toc: true
        toc_float: true
bibliography: biblio/digoxin.bib
csl: biblio/circulation.csl
slug: Digoxin NEJM
categories:
  - R
  - Data Analysis
  - Cardiology
tags:
  - Data Analysis
  - Tidy Data
  - Data Munging
  - R Notebook
---



<div id="philosophy" class="section level1">
<h1>Philosophy</h1>
<blockquote>
<p>Statistics: the only science that enables different experts using the same figures to draw different conclusion <strong>Evan Esar</strong></p>
</blockquote>
<blockquote>
<p>The only statistics you can trust are those you falsified yourself. <strong>Winston Churchill</strong></p>
</blockquote>
</div>
<div id="introduction-and-aim-of-the-analysis" class="section level1">
<h1>Introduction and aim of the analysis</h1>
<p>The aim of this analysis is to reproduce the landmark paper published by <strong>The Digitalis Investigation Group</strong> in 1997 in the <em>New England Journal of Medicine</em><span class="citation"><sup>1</sup></span>. The original dataset has been released for teaching purpose by the <a href="https://www.nhlbi.nih.gov/">National Heart Lung and Blood Institute</a>.</p>
</div>
<div id="perform-an-exploratory-data-analysis" class="section level1">
<h1>Perform an Exploratory Data Analysis</h1>
<div id="read-the-dataset" class="section level2">
<h2>Read the dataset</h2>
<p>The work of the data scientist or researcher begins with the exploration of the actual file that contains the data, its storage format and the way to read it. The file is in my directory <code>/data</code> and i can access it using the command line interface:</p>
<pre class="bash"><code>cd data
cat dig.csv | head -n 2</code></pre>
<pre><code>## ID,TRTMT,AGE,RACE,SEX,EJF_PER,EJFMETH,CHESTX,BMI,KLEVEL,CREAT,DIGDOSER,CHFDUR,RALES,ELEVJVP,PEDEMA,RESTDYS,EXERTDYS,ACTLIMIT,S3,PULCONG,NSYM,HEARTRTE,DIABP,SYSBP,FUNCTCLS,CHFETIOL,PREVMI,ANGINA,DIABETES,HYPERTEN,DIGUSE,DIURETK,DIURET,KSUPP,ACEINHIB,NITRATES,HYDRAL,VASOD,DIGDOSE,CVD,CVDDAYS,WHF,WHFDAYS,DIG,DIGDAYS,MI,MIDAYS,UANG,UANGDAYS,STRK,STRKDAYS,SVA,SVADAYS,VENA,VENADAYS,CREV,CREVDAYS,OCVD,OCVDDAYS,RINF,RINFDAYS,OTH,OTHDAYS,HOSP,HOSPDAYS,NHOSP,DEATH,DEATHDAY,REASON,DWHF,DWHFDAYS
## 1,0,66,1,1,40,2,0.5,20.073,,1.261,0.25,96,0,0,0,0,1,1,0,2,3,96,80,126,1,1,0,1,1,0,1,0,1,1,1,0,1,0,0.25,1,1049,1,1379,0,1438,0,1438,0,1438,0,1438,0,1438,0,1438,0,1438,1,1049,0,1438,1,533,1,533,6,0,1438,,1,1379</code></pre>
<p>The data are stored as “comma-separated-values” where the actual separator is, in fact, the “comma”. It’s a “tidy” dataset, where each row represent an patient and each column a variable. Now it can be read and stored using the appropriate function from the “tidyverse” package <code>read_csv()</code>.</p>
<pre class="r"><code>dig &lt;- read_csv(file = &quot;data/dig.csv&quot;,
                col_types = list(SEX = col_factor(levels = c(&quot;1&quot;, &quot;2&quot;)),
                                 RACE = col_factor(levels = c(&quot;1&quot;, &quot;2&quot;))
                                 ))</code></pre>
</div>
<div id="dataset-structure" class="section level2">
<h2>Dataset structure</h2>
<p>Now is time to explore the structure of the dataframe with the appropriate functions.</p>
<pre class="r"><code>glimpse(dig)</code></pre>
<pre><code>## Observations: 6,800
## Variables: 72
## $ ID       &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16...
## $ TRTMT    &lt;int&gt; 0, 0, 0, 1, 0, 0, 1, 1, 0, 1, 1, 1, 0, 0, 0, 0, 1, 0,...
## $ AGE      &lt;int&gt; 66, 77, 72, 57, 74, 69, 64, 60, 74, 64, 61, 56, 66, 4...
## $ RACE     &lt;fct&gt; 1, 1, 1, 1, 1, 2, 1, 2, 2, 1, 1, 1, 1, 1, 1, 1, 2, 1,...
## $ SEX      &lt;fct&gt; 1, 1, 2, 1, 1, 2, 2, 1, 1, 2, 2, 1, 2, 1, 1, 1, 1, 1,...
## $ EJF_PER  &lt;int&gt; 40, 12, 36, 31, 15, 45, 30, 39, 33, 24, 44, 23, 42, 3...
## $ EJFMETH  &lt;int&gt; 2, 1, 1, 1, 1, 1, 1, 1, 3, 1, 3, 1, 1, 1, 1, 3, 3, 1,...
## $ CHESTX   &lt;dbl&gt; 0.50, 0.56, 0.68, 0.48, 0.53, 0.70, 0.52, 0.40, 0.49,...
## $ BMI      &lt;dbl&gt; 20.073, 20.701, 25.530, 25.794, 25.654, 27.770, 31.69...
## $ KLEVEL   &lt;dbl&gt; NA, 3.1, 5.1, NA, 4.0, 4.3, 4.3, 5.1, 4.7, 4.0, 3.8, ...
## $ CREAT    &lt;dbl&gt; 1.261, 1.500, 1.239, 2.250, 1.466, 1.200, 1.300, 1.00...
## $ DIGDOSER &lt;dbl&gt; 0.250, 0.250, 0.250, 0.250, 0.375, 0.250, 0.250, 0.25...
## $ CHFDUR   &lt;int&gt; 96, 2, 12, 24, 288, 84, 31, 6, 12, 33, 3, 105, 1, 36,...
## $ RALES    &lt;int&gt; 0, 0, 2, 2, 2, 2, 0, 0, 2, 2, 2, 0, 2, 0, 2, 0, 1, 3,...
## $ ELEVJVP  &lt;int&gt; 0, 0, 0, 2, 2, 2, 0, 0, 2, 0, 2, 0, 2, 0, 2, 0, 1, 0,...
## $ PEDEMA   &lt;int&gt; 0, 0, 0, 2, 3, 2, 0, 0, 0, 2, 2, 0, 2, 0, 3, 0, 1, 3,...
## $ RESTDYS  &lt;int&gt; 0, 0, 2, 0, 2, 2, 0, 2, 2, 2, 3, 1, 2, 0, 0, 2, 1, 3,...
## $ EXERTDYS &lt;int&gt; 1, 2, 3, 3, 2, 3, 1, 2, 3, 3, 3, 1, 1, 3, 2, 3, 1, 3,...
## $ ACTLIMIT &lt;int&gt; 1, 2, 3, 3, 0, 3, 0, 2, 3, 2, 3, 3, 3, 3, 3, 3, 1, 3,...
## $ S3       &lt;int&gt; 0, 1, 0, 3, 0, 2, 0, 0, 2, 0, 0, 0, 3, 0, 3, 0, 1, 0,...
## $ PULCONG  &lt;int&gt; 2, 0, 2, 2, 0, 2, 0, 2, 2, 0, 2, 2, 2, 0, 2, 2, 1, 0,...
## $ NSYM     &lt;int&gt; 3, 3, 4, 4, 4, 4, 1, 4, 4, 4, 4, 4, 4, 2, 4, 4, 4, 4,...
## $ HEARTRTE &lt;int&gt; 96, 60, 91, 85, 84, 64, 102, 61, 85, 112, 80, 68, 72,...
## $ DIABP    &lt;int&gt; 80, 95, 70, 80, 60, 76, 90, 80, 70, 80, 90, 70, 78, 8...
## $ SYSBP    &lt;int&gt; 126, 142, 138, 136, 120, 130, 104, 138, 145, 168, 160...
## $ FUNCTCLS &lt;int&gt; 1, 3, 3, 2, 1, 2, 3, 1, 3, 2, 2, 2, 2, 2, 1, 3, 2, 2,...
## $ CHFETIOL &lt;int&gt; 1, 4, 1, 2, 4, 4, 1, 1, 4, 1, 1, 1, 1, 1, 1, 1, 1, 4,...
## $ PREVMI   &lt;int&gt; 0, 1, 0, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 1, 1, 1, 0,...
## $ ANGINA   &lt;int&gt; 1, 1, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1,...
## $ DIABETES &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0,...
## $ HYPERTEN &lt;int&gt; 0, 1, 1, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0,...
## $ DIGUSE   &lt;int&gt; 1, 0, 0, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 0, 0, 0, 0,...
## $ DIURETK  &lt;int&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,...
## $ DIURET   &lt;int&gt; 1, 1, 0, 1, 1, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 1,...
## $ KSUPP    &lt;int&gt; 1, 0, NA, 0, NA, 0, NA, 0, 0, 0, 0, 1, 0, 0, 0, NA, 0...
## $ ACEINHIB &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,...
## $ NITRATES &lt;int&gt; 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0,...
## $ HYDRAL   &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ VASOD    &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ DIGDOSE  &lt;dbl&gt; 0.250, 0.250, 0.250, 0.250, 0.375, 0.250, 0.250, 0.25...
## $ CVD      &lt;int&gt; 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0,...
## $ CVDDAYS  &lt;int&gt; 1049, 468, 631, 1157, 191, 496, 903, 1369, 1747, 149,...
## $ WHF      &lt;int&gt; 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 0, 0,...
## $ WHFDAYS  &lt;int&gt; 1379, 1329, 631, 1157, 191, 1620, 903, 1369, 1747, 10...
## $ DIG      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ DIGDAYS  &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ MI       &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1, 0,...
## $ MIDAYS   &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ UANG     &lt;int&gt; 0, 0, 1, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 0, 0,...
## $ UANGDAYS &lt;int&gt; 1438, 1360, 746, 1157, 1550, 1620, 903, 1369, 1747, 1...
## $ STRK     &lt;int&gt; 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ STRKDAYS &lt;int&gt; 1438, 468, 1391, 1157, 1550, 1620, 903, 1369, 1747, 1...
## $ SVA      &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0,...
## $ SVADAYS  &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ VENA     &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ VENADAYS &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 496, 903, 1369, 1747, 1...
## $ CREV     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0,...
## $ CREVDAYS &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ OCVD     &lt;int&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,...
## $ OCVDDAYS &lt;int&gt; 1049, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ RINF     &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,...
## $ RINFDAYS &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ OTH      &lt;int&gt; 1, 1, 0, 0, 1, 1, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 1,...
## $ OTHDAYS  &lt;int&gt; 533, 880, 1391, 1157, 459, 966, 903, 1369, 1747, 283,...
## $ HOSP     &lt;int&gt; 1, 1, 1, 0, 1, 1, 0, 0, 0, 1, 1, 1, 1, 0, 1, 0, 1, 1,...
## $ HOSPDAYS &lt;int&gt; 533, 468, 631, 1157, 191, 496, 903, 1369, 1747, 149, ...
## $ NHOSP    &lt;int&gt; 6, 4, 2, 0, 5, 5, 0, 0, 0, 2, 8, 1, 1, 0, 1, 0, 1, 3,...
## $ DEATH    &lt;int&gt; 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 1,...
## $ DEATHDAY &lt;int&gt; 1438, 1360, 1391, 1157, 1550, 1620, 903, 1369, 1747, ...
## $ REASON   &lt;int&gt; NA, 1, NA, NA, NA, NA, 2, NA, NA, NA, NA, 1, 1, 2, 2,...
## $ DWHF     &lt;int&gt; 1, 1, 1, 0, 1, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0,...
## $ DWHFDAYS &lt;int&gt; 1379, 1329, 631, 1157, 191, 1620, 903, 1369, 1747, 10...</code></pre>
<p>The DIG trial was designed as a randomized, double-blind, multicenter trial with more than 300 centers.</p>
<p>First we can explore the distribution of data in some common variables.</p>
<pre class="r"><code>#histograms by groups
histgg &lt;- function(df, x, grp){
    x &lt;- enquo(x) # the data
    grp &lt;- enquo(grp) #the actual group
    ggplot(aes(!!x), data = df) +
        geom_histogram() +
        labs(x = &quot;Value&quot;, y = &quot;Count&quot;) +
        facet_grid(cols = vars(!!grp), scales = &quot;free&quot;) +
        theme_bw()
}

expl &lt;- dig %&gt;% select(AGE, EJF_PER, CHFDUR) %&gt;%
                mutate(ID = 1:nrow(dig)) %&gt;%
                rename(`EF(%)` = EJF_PER, `CHF duration (months)` = CHFDUR) %&gt;% 
                gather(key = Variable, value = Measure, -ID)
        

histgg(df = expl, x = Measure, grp = Variable)</code></pre>
<p><img src="/post/2018-07-31-digoxinNEJM_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>From this facet plot is possible to infer about the distribution of data. While AGE and EF(%) are almost normally distributed, the CHF duration is right-skewed. Clinically this value can be explained by the disease itself, beared by high mortality: most patients are enrolled within few months from the first episode of decompensation, while a little proportion has chronic heart failure with some acute phase. In this case AGE and EF can be described by mean and standard deviation. A more robust measure of central tendency is required for the CHF duration parameter, such as the median. In Table 1 of the paper, the authors expressed these variables accordingly. As in summary tables, the authors operated a breakdown into the two groups, Digoxin and Placebo.</p>
<p>We can replicate the previous part using a different tools in R language.</p>
<p>The first is to calculate mean, sd and summarise for each group; another tool is to use a function of the <code>apply</code> family, i.e. <code>tapply()</code>; we can use tools from <code>tidyverse</code> such as <code>groupby()</code> and <code>summarize()</code>; finally a specific package <code>compareGroups()</code> that produces an output very close to publish-ready format we are use to in biomedical journals.</p>
<pre class="r"><code>#digoxin mean and sd
mean(dig$AGE[dig$TRTMT == 1], na.rm = TRUE)</code></pre>
<pre><code>## [1] 63.4189</code></pre>
<pre class="r"><code>sd(dig$AGE[dig$TRTMT == 1], na.rm = TRUE)</code></pre>
<pre><code>## [1] 11.0244</code></pre>
<pre class="r"><code>#placebo mean and sd
mean(dig$AGE[dig$TRTMT == 0], na.rm = TRUE)</code></pre>
<pre><code>## [1] 63.54746</code></pre>
<pre class="r"><code>sd(dig$AGE[dig$TRTMT == 0], na.rm = TRUE)</code></pre>
<pre><code>## [1] 10.8136</code></pre>
<pre class="r"><code>tapply(dig$AGE, dig$TRTMT, function(x) c(mean(x), sd(x)))</code></pre>
<pre><code>## $`0`
## [1] 63.54746 10.81360
## 
## $`1`
## [1] 63.4189 11.0244</code></pre>
<pre class="r"><code>dig %&gt;% 
    select(AGE, TRTMT) %&gt;% 
    mutate(TRTMT = factor(TRTMT)) %&gt;% 
    mutate(TRTMT = fct_recode(TRTMT, digoxin = &quot;1&quot;, placebo = &quot;0&quot;)) %&gt;% 
    group_by(TRTMT) %&gt;% 
    summarise(mean = mean(AGE), sd = sd(AGE)) </code></pre>
<pre><code>## # A tibble: 2 x 3
##   TRTMT    mean    sd
##   &lt;fct&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 placebo  63.5  10.8
## 2 digoxin  63.4  11.0</code></pre>
<pre class="r"><code>summ_stat &lt;- dig %&gt;% 
                select(AGE, EJF_PER, CHFDUR, TRTMT)
summ_stat_com &lt;- compareGroups(TRTMT~AGE+EJF_PER+CHFDUR, data = summ_stat)
compareGroups::createTable(summ_stat_com)</code></pre>
<pre><code>## 
## --------Summary descriptives table by &#39;TRTMT&#39;---------
## 
## _________________________________________ 
##              0           1      p.overall 
##           N=3403      N=3397              
## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯ 
## AGE     63.5 (10.8) 63.4 (11.0)   0.627   
## EJF_PER 28.4 (8.85) 28.6 (8.85)   0.380   
## CHFDUR  29.8 (36.5) 30.5 (37.2)   0.422   
## ¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯¯</code></pre>
<pre class="r"><code>mean_sd &lt;- function(x, r)  {
    x &lt;- as.numeric(x)
    r &lt;- as.numeric(r) #insert the number for rounding
    m &lt;- round(mean(x, na.rm = T),r) #calculate the mean
    s &lt;- round(sd(x, na.rm = T),r) #calculate the SD
    result &lt;- paste(m, s, sep=&quot;±&quot;) #create a character vector to be printed
    return(result) #print the string
}

#use tapply to 
tapply(dig$AGE, dig$TRTMT, function(x) mean_sd(x, r = 2))</code></pre>
<pre><code>##             0             1 
## &quot;63.55±10.81&quot; &quot;63.42±11.02&quot;</code></pre>
<pre class="r"><code>tapply(dig$EJF_PER, dig$TRTMT, function(x) mean_sd(x, r = 2))</code></pre>
<pre><code>##            0            1 
## &quot;28.45±8.85&quot; &quot;28.63±8.85&quot;</code></pre>
<pre class="r"><code>tapply(dig$CHFDUR, dig$TRTMT, function(x) median(x, na.rm = TRUE))</code></pre>
<pre><code>##  0  1 
## 16 17</code></pre>
<p>Some are pretty, some others are pretty ugly as output. Anyway they confirm the reproducibility of the data written in the paper.</p>
<p>In the second part of Table 1 are listed all the categorical variables and expressed as percentage of patients. To reproduce it, we need to modify the existing variables and levels.</p>
<p>In this case, the Tidyverse function makes the life really easy.</p>
<pre class="r"><code>dig_cat &lt;- dig %&gt;% 
                select(SEX, RACE, AGE, EJFMETH, CHESTX, FUNCTCLS, NSYM, PREVMI, ANGINA,
                       DIABETES, HYPERTEN, DIGUSE, CHFETIOL, DIURET, DIURETK, ACEINHIB,
                       NITRATES, HYDRAL, VASOD, DIGDOSER)

dig_cat &lt;- dig_cat %&gt;% 
                mutate(SEX = fct_recode(SEX,
                                        &quot;Male&quot; = &quot;1&quot;, &quot;Female&quot; = &quot;2&quot;))</code></pre>
</div>
</div>
<div id="bibliography" class="section level1 unnumbered">
<h1>Bibliography</h1>
<div id="refs" class="references">
<div id="ref-digNEJM">
<p>1. Group DI. The effect of digoxin on mortality and morbidity in patients with heart failure. <em>New England Journal of Medicine</em> [Internet]. 1997;336:525–533. Available from: <a href="http://dx.doi.org/10.1056/NEJM199702203360801" class="uri">http://dx.doi.org/10.1056/NEJM199702203360801</a></p>
</div>
</div>
</div>
